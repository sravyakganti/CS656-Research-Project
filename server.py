import socket
import rsa
import time

# RSA Private Key Components
n=16392362778256780220954276216546242254283082059831755731579401885794615283058219194385117331167932338939934809926325344824272192435155520791240827118866751725451188130227783725386919016357212747309448444286821026436919609641860419335129545738225312480018195593328936241320448758153962633252574639254433999108833960961102349202779669773155325870156635925761560139637302661811797932859047350600091239313544006776913160750088183132068656619332430225794363409684374938395692704525996724092129007165328531309237676346707052272668702382542488378374969810765214796973666394162198599703279169493550965785926632442580800799579
e = 65537  # Replace with actual 'e' value
d=10466680086347150848010324588516319840284569813627716409717741906296618263497783548350391684698007181520065185409417739284930560822764513527171882320156523684380280124166681992958802098943862621479640197134844632379866914644754735607333734698899498390814981045797681705819544665360189211453096500863638622311995598981523332045803020663988763532400791004668016289106703956382523069710743248704395408647318058428610467347676160517097132102750785893180152723738963313638183098953927586104078827864055948669683571046113384832939697755150366750913507160305440401546727824996460561759972515523801555103879959744585071018145
p=2046861758370232190579992351149316361262495123587656964955228407948096548400708417260886491775253386892264494176519846217723313583938831369937831624164193359186195838960585673805669133999097513931472476528576167210186548518684525595544585625576275222553582806643776190942344660045900483012097871191644434852528719628203982330553
q=8008534387446288393334104036094582509689470153324708310458870978773504767113449971897293551355762606441039911337565952271130122564337018595051392633108830900918105417456978447733147718833287519346336998344371504179210481516227890642326335110585842254835679846537259871815421733249069118643
private_key = rsa.PrivateKey(n, e, d, p, q,)
# Set up the server
server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server.bind(('localhost', 12345))
server.listen(1)
print("Server is listening for connections...")

try:
    conn, addr = server.accept()
    print(f"Connected to {addr}")

    # Receive encrypted file data
    encrypted_file_data = conn.recv(4096)  # Increased buffer size
    start_time = time.time()
    try:
        decrypted_file_data = rsa.decrypt(encrypted_file_data, private_key)
        end_time = time.time()
        print(f"Decryption time: {end_time - start_time} seconds")
        conn.send(b"Decryption successful")
    except Exception as e:
        print("Decryption failed:", str(e))
        conn.send(b"Decryption failed")

    conn.close()
except Exception as e:
    print("Server error:", str(e))

server.close()